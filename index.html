<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Vis Network | Basic usage</title>

    <script type="text/javascript" src="js/vis-network.min.js"></script>

    <style type="text/css">
      #mynetwork {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%	;
        border: 1px solid lightgray;
      }
    </style>
  </head>
  <body>
    <p>Create a simple network with some nodes and edges.</p>

    <div id="mynetwork"></div>

    <script type="text/javascript">
	const root = 'https://www.umr-lastig.fr';
	const default_img = '/lastig_data/img/abstract-user-icon.svg';

	function date(s) {
		const split = s.split('/');
		const d = Date.parse(split[2],split[1],split[0]);
		return d;
	}

	function init(people) {
		// create an array with nodes
		var nodes = new vis.DataSet([]);
		var edges = new vis.DataSet([]);

		nodes.add({id:'LASTIG', label:'LASTIG', shape:'image', size:50, image: root+'/img/lastig_400.png', href: root});
		nodes.add({id:'ACTE', label:'ACTE', group:'team', image: root+'/img/icons/logo_acte_1280.png', href: root+'/acte/'});
		nodes.add({id:'GEOVIS', label:'GEOVIS', group:'team', image: root+'/img/icons/logo_geovis_1280.png', href: root+'/geovis/'});
		nodes.add({id:'STRUDEL', label:'STRUDEL', group:'team', image: root+'/img/icons/logo_strudel_1280.png', href: root+'/strudel/'});
		nodes.add({id:'MEIG', label:'MEIG', group:'team', image: root+'/img/icons/logo_meig_1280.png', href: root+'/meig/'});

		for(const line of people.split('\n')) {
			const cols = line.trim().split(',');
			if(cols.length < 3 || cols[0]=='firstname') continue;
			const firstname = cols[0];
			const lastname = cols[1];
			const team = cols[2];
			const statut = cols[3];
			const status = cols[4];
			cols[5] = cols[5] || default_img;
			const href = cols[5].startsWith('http')? cols[5] : (root+cols[5]);
			const HAL = cols[6];
			const start_date = cols[7];
			const end_date = cols[8];
			console.log(lastname, date(start_date), date(end_date));
			const member = cols[9] == 'true';
			const photo = cols[10].startsWith('http')? cols[10] : (root+cols[10]);
			const perm = cols[11] == 'true';
			const id = firstname+'\n'+lastname;
			nodes.add({ id: id, label:id, shape:'circularImage', image: photo, opacity:member?1:0.2, href:href, perm:perm, start: });
			edges.add({ from: id, to: team});
		}

		edges.add({ from: 'ClÃ©ment\nMallet', to: 'LASTIG'});
		edges.add({ from: 'Ana-Maria\nOlteanu-Raimond', to: 'LASTIG'});

		edges.add({ from: 'ACTE', to: 'LASTIG'});
		edges.add({ from: 'MEIG', to: 'LASTIG'});
		edges.add({ from: 'GEOVIS', to: 'LASTIG'});
		edges.add({ from: 'STRUDEL', to: 'LASTIG'});

		// create a network

		const nodesFilter = (node) => {
			return node.group=='team' || node.perm;
		};
		const edgesFilter = (edge) => {
			return true;
		};
		const nodesView = new vis.DataView(nodes, { filter: nodesFilter });
		const edgesView = new vis.DataView(edges, { filter: edgesFilter });

		var container = document.getElementById("mynetwork");
		var data = {
			nodes: nodesView,
			edges: edgesView,
		};
		var options = {
		groups: {
			team: {shape:'circularImage', size:100}
		}
		};
		var network = new vis.Network(container, data, options);

		network.on( 'doubleClick', function(properties) {
			var nodeId = network.getNodeAt({x:properties.event.srcEvent.offsetX, y:properties.event.srcEvent.offsetY});
			var node = nodes.get(nodeId);
			window.location=node.href;
		});      
      }
      
      fetch("people.csv").then(response => response.text()).then(init);
      
    </script>
  </body>
</html>

